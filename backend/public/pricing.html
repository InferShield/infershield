<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing - InferShield</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <!-- Matrix Background -->
    <canvas id="matrix" class="matrix-bg"></canvas>

    <div class="container" style="padding: 60px 20px;">
        <header style="margin-bottom: 60px; text-align: center;">
            <pre class="ascii-logo-small" style="font-size: 14px; color: #00d9ff;">
 ___      ___     ___
|_ _|___ |  _|___|_  |
 | ||   ||  _| -_|  _|
|___|_|_||_| |___|___|
Shield
            </pre>
            <h1 class="glow" style="margin-top: 20px;">Choose Your Plan</h1>
            <p class="comment" style="margin-top: 10px;">Protect your AI applications from PII leaks</p>
        </header>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto;">
            
            <!-- Free Plan -->
            <div class="terminal">
                <div class="terminal-header">
                    <span class="dot green"></span>
                    <span class="terminal-title">free.plan</span>
                </div>
                <div class="terminal-body" style="min-height: 420px; display: flex; flex-direction: column;">
                    <h2 style="color: #e0e0e0; margin-bottom: 10px;">Free</h2>
                    <div style="margin-bottom: 30px;">
                        <span style="font-size: 42px; font-weight: bold; color: #00d9ff;">$0</span>
                        <span class="comment">/month</span>
                    </div>
                    <div style="flex: 1;">
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> 100 requests/month</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Basic PII detection</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> MASK redaction</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Community support</div>
                    </div>
                    <button class="btn btn-secondary btn-full" style="margin-top: 20px;" disabled>Current Plan</button>
                </div>
            </div>

            <!-- Pro Plan -->
            <div class="terminal" style="border-color: #00ff88; box-shadow: 0 0 40px rgba(0, 255, 136, 0.3);">
                <div class="terminal-header" style="background: rgba(0, 255, 136, 0.1);">
                    <span class="dot green"></span>
                    <span class="terminal-title">pro.plan</span>
                    <span style="background: #00ff88; color: #0a0e27; padding: 2px 8px; border-radius: 3px; font-size: 10px; font-weight: bold; margin-left: 10px;">POPULAR</span>
                </div>
                <div class="terminal-body" style="min-height: 420px; display: flex; flex-direction: column;">
                    <h2 style="color: #e0e0e0; margin-bottom: 10px;">Pro</h2>
                    <div style="margin-bottom: 30px;">
                        <span style="font-size: 42px; font-weight: bold; color: #00ff88;">$99</span>
                        <span class="comment">/month</span>
                    </div>
                    <div style="flex: 1;">
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> 10,000 requests/month</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> All PII types</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> PARTIAL + HASH redaction</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Compliance reports</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Email support</div>
                    </div>
                    <button id="upgradeProBtn" class="btn btn-primary btn-full" style="margin-top: 20px;">Upgrade to Pro</button>
                </div>
            </div>

            <!-- Enterprise Plan -->
            <div class="terminal">
                <div class="terminal-header">
                    <span class="dot green"></span>
                    <span class="terminal-title">enterprise.plan</span>
                </div>
                <div class="terminal-body" style="min-height: 420px; display: flex; flex-direction: column;">
                    <h2 style="color: #e0e0e0; margin-bottom: 10px;">Enterprise</h2>
                    <div style="margin-bottom: 30px;">
                        <span style="font-size: 42px; font-weight: bold; color: #00d9ff;">$499</span>
                        <span class="comment">/month</span>
                    </div>
                    <div style="flex: 1;">
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Unlimited requests</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Everything in Pro</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> TOKEN + REMOVE strategies</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Custom patterns</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> SSO integration</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> SLA guarantee</div>
                        <div style="margin-bottom: 12px;"><span class="prompt">></span> Dedicated support</div>
                    </div>
                    <button id="contactSalesBtn" class="btn btn-secondary btn-full" style="margin-top: 20px;">Contact Sales</button>
                </div>
            </div>

        </div>

        <!-- Contact Sales Modal -->
        <div id="contactModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8);">
            <div class="terminal" style="margin: 80px auto; max-width: 500px; width: 90%;">
                <div class="terminal-header">
                    <span class="dot red"></span>
                    <span class="dot yellow"></span>
                    <span class="dot green"></span>
                    <span class="terminal-title">contact_sales.sh</span>
                    <span id="closeModal" style="margin-left: auto; cursor: pointer; color: #00d9ff; font-size: 20px;">&times;</span>
                </div>
                <div class="terminal-body">
                    <h2 style="color: #00d9ff; margin-bottom: 20px;">Contact Sales</h2>
                    <form id="contactForm">
                        <div class="form-group">
                            <label class="form-label"><span class="prompt">></span> Your Name</label>
                            <input type="text" id="contactName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><span class="prompt">></span> Email</label>
                            <input type="email" id="contactEmail" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><span class="prompt">></span> Company</label>
                            <input type="text" id="contactCompany" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label"><span class="prompt">></span> Expected Monthly Volume</label>
                            <select id="contactVolume" class="form-input">
                                <option value="10k-50k">10K - 50K requests</option>
                                <option value="50k-100k">50K - 100K requests</option>
                                <option value="100k-500k">100K - 500K requests</option>
                                <option value="500k+">500K+ requests</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label"><span class="prompt">></span> Message</label>
                            <textarea id="contactMessage" rows="4" class="form-input" placeholder="Tell us about your use case..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">Send Message</button>
                    </form>
                </div>
            </div>
        </div>

        <div style="margin-top: 60px; text-align: center;">
            <a href="dashboard.html" class="link">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <script src="assets/js/matrix.js"></script>
    <script>
        const API_BASE = window.location.origin + '/api';

        // Get auth token from localStorage
        function getAuthToken() {
            return localStorage.getItem('infershield_token');
        }

        // Check if user is logged in (silent check, no alert)
        function isAuthenticated() {
            const token = getAuthToken();
            return !!token;
        }

        // API request helper
        async function apiRequest(path, options = {}) {
            const token = getAuthToken();
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const response = await fetch(`${API_BASE}${path}`, {
                ...options,
                headers
            });

            if (response.status === 401) {
                localStorage.removeItem('token');
                alert('Your session has expired. Please log in again.');
                window.location.href = '/login.html';
                throw new Error('Authentication required');
            }

            return response;
        }

        // Upgrade to Pro
        document.getElementById('upgradeProBtn').addEventListener('click', async () => {
            // Only check auth when clicking upgrade button
            const token = getAuthToken();
            console.log('[Pricing] Auth token exists:', !!token);
            console.log('[Pricing] Token preview:', token ? token.substring(0, 20) + '...' : 'null');
            
            if (!token) {
                console.log('[Pricing] No token found, redirecting to login');
                window.location.href = '/login.html?redirect=/pricing.html';
                return;
            }

            try {
                console.log('[Pricing] Making checkout API call...');
                const btn = document.getElementById('upgradeProBtn');
                btn.disabled = true;
                btn.textContent = 'Processing...';

                // Get Stripe checkout session
                const response = await apiRequest('/billing/checkout', {
                    method: 'POST',
                    body: JSON.stringify({
                        plan: 'pro'
                    })
                });

                console.log('[Pricing] API response status:', response.status);
                const result = await response.json();
                console.log('[Pricing] API response:', result);

                if (result.success && result.url) {
                    // Redirect to Stripe checkout
                    console.log('[Pricing] Redirecting to Stripe:', result.url);
                    window.location.href = result.url;
                } else {
                    throw new Error(result.error || 'Failed to create checkout session');
                }
            } catch (error) {
                console.error('[Pricing] Checkout failed:', error);
                alert('Failed to start upgrade: ' + error.message);
                const btn = document.getElementById('upgradeProBtn');
                btn.disabled = false;
                btn.textContent = 'Upgrade to Pro';
            }
        });

        // Contact Sales Modal
        const modal = document.getElementById('contactModal');
        const contactBtn = document.getElementById('contactSalesBtn');
        const closeBtn = document.getElementById('closeModal');

        contactBtn.addEventListener('click', () => {
            // Only check auth when clicking contact sales
            if (!isAuthenticated()) {
                window.location.href = '/login.html?redirect=/pricing.html';
                return;
            }
            
            modal.style.display = 'block';
            
            // Pre-fill email if logged in
            apiRequest('/auth/me')
                .then(r => r.json())
                .then(data => {
                    if (data.success && data.user) {
                        document.getElementById('contactEmail').value = data.user.email;
                        document.getElementById('contactName').value = data.user.name || '';
                    }
                })
                .catch(() => {});
        });

        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Submit contact form
        document.getElementById('contactForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                company: document.getElementById('contactCompany').value,
                volume: document.getElementById('contactVolume').value,
                message: document.getElementById('contactMessage').value
            };

            try {
                const response = await apiRequest('/billing/contact', {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    alert('Thank you! Our sales team will contact you within 24 hours.');
                    modal.style.display = 'none';
                    document.getElementById('contactForm').reset();
                } else {
                    throw new Error(result.error || 'Failed to send message');
                }
            } catch (error) {
                alert('Failed to send message: ' + error.message);
            }
        });
    </script>
</body>
</html>
